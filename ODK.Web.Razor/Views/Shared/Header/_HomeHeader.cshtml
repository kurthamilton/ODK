@using ODK.Core.Chapters
@using ODK.Core.Members
@using ODK.Core.Platforms
@using ODK.Core.Utils
@using ODK.Services.Chapters
@using ODK.Web.Common.Components
@using ODK.Web.Common.Routes
@using ODK.Web.Razor.Models
@using ODK.Web.Razor.Models.Header
@using ODK.Web.Razor.Services
@model OdkComponentContext
@inject IChapterService ChapterService
@inject IRequestStore RequestStore
@{
    if (Model.Platform != PlatformType.DrunkenKnitwits)
    {
        return;
    }

    var member = await RequestStore.GetCurrentMemberOrDefault();

    var viewModel = await ChapterService.GetChaptersDto(Model.Platform);
    var menuItems = viewModel
        .Chapters
        .OrderBy(x => x.Name)
        .Select(c => new MenuItem
        {
            ExternalLink = !string.IsNullOrEmpty(c.RedirectUrl) ? c.RedirectUrl : null,
            Link = string.IsNullOrEmpty(c.RedirectUrl) ? OdkRoutes.Groups.Group(Model.Platform, c) : null,
            Text = c.GetDisplayName(Model.Platform)
        })
        .ToArray();
}

@await Html.PartialAsync("Header/_Header", new HeaderViewModel(Model)
{   
   ImageLink = "/",
   ImageUrl = "/assets/img/home-banner.png",
   Navbar = new NavbarViewModel(Model)
   {
       Breakpoint = "md",
       Chapter = null,
       Color = "dark",
       Compact = false,
       CssClass = "navbar--home d-md-none",
       HideAccountMenu = false,
       Member = member,
       MenuItems = menuItems.Segment(5).ToArray()
   }
})