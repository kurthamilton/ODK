@using ODK.Services.Chapters.ViewModels
@using ODK.Web.Common.Components
@using ODK.Web.Common.Routes
@using ODK.Web.Razor.Models.Components
@model SiteAdminChaptersViewModel
@{
    var tabs = new TabsViewModel
    {
        MenuItems = new[]
        {
            new MenuItem { Text = "Approved", Link = "#approved-tab-pane" },
            new MenuItem { Text = "Pending", Link = "#pending-tab-pane" }
        }
    };
}

<h2>Groups</h2>

@await Html.PartialAsync("Components/_Tabs", tabs)

<div class="tab-content">
    @*Approved*@
    <div class="tab-pane fade" id="approved-tab-pane" role="tabpanel" tabindex="0">
        <section class="section">
            <div class="table-responsive">
                <table class="table table--striped">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Created</th>
                            <th>Published</th>
                            <th>Subscription</th>
                            <th>Expires</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var row in Model.Approved)
                        {
                            var chapter = row.Chapter;

                            <tr>
                                <td>
                                    <a href="@OdkRoutes.SiteAdmin.Group(chapter.Id)">
                                        @chapter.GetDisplayName(Model.Platform)
                                    </a>                                    
                                </td>
                                <td>@chapter.CreatedUtc.ToString("yyyy-MM-dd HH:mm:ss")</td>
                                <td>@chapter.PublishedUtc?.ToString("yyyy-MM-dd HH:mm:ss")</td>
                                <td>@row.SiteSubscriptionName</td>
                                <td>@row.SiteSubscriptionExpiresUtc?.ToString("yyyy-MM-dd HH:mm:ss")</td>
                                <td>
                                    <a href="@OdkRoutes.MemberGroups.Group(Model.Platform, chapter)">
                                        Admin
                                    </a>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </section>
    </div>

    @*Pending*@
    <div class="tab-pane fade" id="pending-tab-pane" role="tabpanel" tabindex="0">
        <section class="section">
            <div class="table-responsive">
                <table class="table table--striped">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Created</th>
                            <th></th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var row in Model.Pending)
                        {
                            var chapter = row.Chapter;

                            <tr>
                                <td>@chapter.GetDisplayName(Model.Platform)</td>
                                <td>@chapter.CreatedUtc.ToString("yyyy-MM-dd HH:mm:ss")</td>
                                <td>
                                    <a href="@OdkRoutes.MemberGroups.Group(Model.Platform, chapter)">
                                        Admin
                                    </a>
                                </td>
                                <td>
                                    <div class="button-container">
                                        <form action="/siteadmin/groups/@chapter.Id/approve" method="post">
                                            @*@Html.AntiForgeryToken()*@
                                            <button class="btn btn-success btn-sm">Approve</button>
                                        </form>
                                        <form action="/siteadmin/groups/@chapter.Id/delete" method="post">
                                            @*@Html.AntiForgeryToken()*@
                                            <button class="btn btn-danger btn-sm"
                                                    onclick="return confirm('Are you sure you want to delete this group?');">
                                                Delete
                                            </button>
                                        </form>
                                    </div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </section>
    </div>
</div>       