@using ODK.Core.Utils
@using ODK.Services
@using ODK.Services.Events
@using ODK.Services.Events.ViewModels
@using ODK.Web.Common.Components
@using ODK.Web.Common.Extensions
@using ODK.Web.Common.Routes
@using ODK.Web.Razor.Models.Admin
@using ODK.Web.Razor.Models.Admin.Events
@using ODK.Web.Razor.Models.Components
@model EventCreateAdminPageViewModel
@inject IOdkRoutes OdkRoutes
@{
    var hostOptions = Model.AdminMembers
        .Select(x => new SelectListItem
        {
            Value = x.MemberId.ToString(),
            Text = x.Member.FullName
        })
        .ToArray();
}

@if (Model.Venues.Count > 0)
{
    <form method="post">
        @*@Html.AntiForgeryToken()*@

        @await Html.PartialAsync("Admin/Events/Event/_EventForm", new EventFormViewModel
        {
            Chapter = Model.Chapter,
            Currency = Model.Currency,
            Date = Model.Date,
            Description = Model.EventSettings?.DefaultDescription,
            EndTime = TimeSpanUtils.ToString(Model.EventSettings?.DefaultEndTime),
            HostOptions = hostOptions,
            OwnerSubscription = Model.OwnerSubscription,
            Venue = Model.VenueId ?? default,
            Venues = Model.Venues
        })

        <div class="button-container-md">
            <button type="submit" class="btn btn-primary">Create</button>
            <button type="submit" class="btn btn-secondary" name="draft" value="true">Save as draft</button>
        </div>
    </form>
}
else
{
    <p>
        You have not yet created any venues.
    </p>
    <p>
        @await Html.PartialAsync("Admin/_AdminLink", new AdminLinkViewModel
        {
            Class = "btn btn-primary",
            Route = OdkRoutes.GroupAdmin.VenueCreate(Model.Chapter),
            Text = "Create venue"
        })
    </p>
}