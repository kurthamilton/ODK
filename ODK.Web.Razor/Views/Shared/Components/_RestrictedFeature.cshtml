@using ODK.Core.Platforms
@using ODK.Services.Authorization
@using ODK.Web.Common.Services
@using ODK.Web.Razor.Models.Components
@using ODK.Web.Razor.Services
@model RestrictedFeatureViewModel
@inject IAuthorizationService AuthorizationService
@inject IRequestStore RequestStore
@{
    var platform = RequestStore.Platform;
    var authorized = Model.Permitted != null 
        ? Model.Permitted.Value 
        : Model.OwnerSubscription != null 
            ? AuthorizationService.ChapterHasAccess(Model.OwnerSubscription, Model.Feature)
            : Model.Chapter != null 
                ? await AuthorizationService.ChapterHasAccess(Model.Chapter, Model.Feature)
                : false;
}

@if (authorized)
{
    @if (Model.Content != null)
    {
        @Model.Content
    }

    @if (Model.ContentFunc != null)
    {
        @Model.ContentFunc.Invoke(null)
    }    
}
else
{
    @await Html.PartialAsync("Components/_UpgradeButton", new UpgradeButtonViewModel
    {
        Chapter = Model.Chapter,
        Platform = platform
    })
    @Model.DisabledContentFunc?.Invoke(null)
}