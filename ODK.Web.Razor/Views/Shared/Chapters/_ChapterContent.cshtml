@using ODK.Services.Chapters.ViewModels
@using ODK.Services.SocialMedia
@using ODK.Web.Razor.Models.Components
@using ODK.Web.Razor.Models.Members
@model ChapterHomePageViewModel
@inject ISocialMediaService SocialMediaService

@if (Model.CurrentMember?.IsMemberOf(Model.Chapter.Id) != true)
{    
    <h3>Welcome!</h3>
    @if (!string.IsNullOrEmpty(Model.Texts?.WelcomeText))
    {
        @Html.Raw(Model.Texts.WelcomeText)
    }
}
else
{    
    <h3>Latest members</h3>
    
    @await Html.PartialAsync("Members/_MemberList", new MemberListViewModel
    {
        Chapter = Model.Chapter,
        Cols = 2,
        Members = Model.LatestMembers
            .Select(x => new ListMemberViewModel
            {
                AvatarVersion = x.AvatarVersion,
                Chapter = Model.Chapter,
                Member = x.Member,
                Platform = Model.Platform
            })
            .ToArray(),
        Platform = Model.Platform
    })
}

@if (Model.InstagramPosts.Posts.Count > 0)
{
    <div class="mt-3">
        <h3>Latest from Instagram</h3>
        <div class="row row-cols-2 row-cols-lg-4 g-0">
            @foreach (var post in Model.InstagramPosts.Posts)
            {
                <div class="col">
                    @await Html.PartialAsync("Components/Instagram/_InstagramPost", post)
                </div>
            }
        </div>

        @if (!string.IsNullOrEmpty(Model.Links?.InstagramName))
        {
            <div class="d-flex align-content-center">
                <div>
                    @await Html.PartialAsync("Components/_IconLink", new IconLinkViewModel
                    {
                        Icon = IconType.Instagram,
                        Text = Model.Links.InstagramName,
                        Url = SocialMediaService.GetInstagramChannelUrl(Model.Links.InstagramName)
                    })
                </div>
            </div>
        }        
    </div>
}