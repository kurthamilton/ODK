@page "/groups/{slug}/subscription/{chapterSubscriptionId:guid}/checkout"
@using ODK.Core.Payments
@using ODK.Services.Chapters
@using ODK.Services.Members
@using ODK.Web.Razor.Models.Groups
@using ODK.Web.Razor.Models.Payments
@model CheckoutModel
@inject IChapterViewModelService ChapterViewModelService
@inject IMemberService MemberService
@{
    Layout = "_HomeLayout";

    var groupRequest = Model.ChapterServiceRequest;
    var group = await ChapterViewModelService.GetGroupPage(
        groupRequest, Model.CurrentMemberOrDefault);

    var returnUrl = "";

    var checkoutRequest = Model.MemberChapterServiceRequest;
    var viewModel = await MemberService.StartChapterSubscriptionCheckoutSession(
        checkoutRequest, Model.ChapterSubscriptionId, returnUrl);
}

@await Html.PartialAsync("Groups/_GroupBody", new GroupBodyViewModel
{
    Title = "",
    Content = await Html.PartialAsync("Groups/Subscription/_GroupSubscriptionCheckoutContent", viewModel),
    Group = group
})

@section scripts
{
    @await Html.PartialAsync("Payments/_PaymentScripts", new PaymentScriptsViewModel
    {
        Providers = [viewModel.PaymentSettings.Provider]
    })
}